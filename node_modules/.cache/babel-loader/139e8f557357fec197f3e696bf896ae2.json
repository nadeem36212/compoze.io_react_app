{"ast":null,"code":"/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n  return ar;\n};\nimport { ConsoleLogger as Logger } from './Logger';\nvar logger = new Logger('Hub');\nvar AMPLIFY_SYMBOL = typeof Symbol !== 'undefined' && typeof Symbol.for === 'function' ? Symbol.for('amplify_default') : '@@amplify_default';\nfunction isLegacyCallback(callback) {\n  return callback.onHubCapsule !== undefined;\n}\nvar HubClass = /** @class */function () {\n  function HubClass(name) {\n    this.listeners = [];\n    this.patterns = [];\n    this.protectedChannels = ['core', 'auth', 'api', 'analytics', 'interactions', 'pubsub', 'storage', 'ui', 'xr'];\n    this.name = name;\n  }\n  // Note - Need to pass channel as a reference for removal to work and not anonymous function\n  HubClass.prototype.remove = function (channel, listener) {\n    if (channel instanceof RegExp) {\n      var pattern_1 = this.patterns.find(function (_a) {\n        var pattern = _a.pattern;\n        return pattern.source === channel.source;\n      });\n      if (!pattern_1) {\n        logger.warn(\"No listeners for \" + channel);\n        return;\n      }\n      this.patterns = __spread(this.patterns.filter(function (x) {\n        return x !== pattern_1;\n      }));\n    } else {\n      var holder = this.listeners[channel];\n      if (!holder) {\n        logger.warn(\"No listeners for \" + channel);\n        return;\n      }\n      this.listeners[channel] = __spread(holder.filter(function (_a) {\n        var callback = _a.callback;\n        return callback !== listener;\n      }));\n    }\n  };\n  HubClass.prototype.dispatch = function (channel, payload, source, ampSymbol) {\n    if (source === void 0) {\n      source = '';\n    }\n    if (this.protectedChannels.indexOf(channel) > -1) {\n      var hasAccess = ampSymbol === AMPLIFY_SYMBOL;\n      if (!hasAccess) {\n        logger.warn(\"WARNING: \" + channel + \" is protected and dispatching on it can have unintended consequences\");\n      }\n    }\n    var capsule = {\n      channel: channel,\n      payload: __assign({}, payload),\n      source: source,\n      patternInfo: []\n    };\n    try {\n      this._toListeners(capsule);\n    } catch (e) {\n      logger.error(e);\n    }\n  };\n  HubClass.prototype.listen = function (channel, callback, listenerName) {\n    var _this = this;\n    if (listenerName === void 0) {\n      listenerName = 'noname';\n    }\n    var cb;\n    // Check for legacy onHubCapsule callback for backwards compatability\n    if (isLegacyCallback(callback)) {\n      logger.warn(\"WARNING onHubCapsule is Deprecated. Please pass in a callback.\");\n      cb = callback.onHubCapsule.bind(callback);\n    } else if (typeof callback !== 'function') {\n      throw new Error('No callback supplied to Hub');\n    } else {\n      cb = callback;\n    }\n    if (channel instanceof RegExp) {\n      this.patterns.push({\n        pattern: channel,\n        callback: cb\n      });\n    } else {\n      var holder = this.listeners[channel];\n      if (!holder) {\n        holder = [];\n        this.listeners[channel] = holder;\n      }\n      holder.push({\n        name: listenerName,\n        callback: cb\n      });\n    }\n    return function () {\n      _this.remove(channel, cb);\n    };\n  };\n  HubClass.prototype._toListeners = function (capsule) {\n    var channel = capsule.channel,\n      payload = capsule.payload;\n    var holder = this.listeners[channel];\n    if (holder) {\n      holder.forEach(function (listener) {\n        logger.debug(\"Dispatching to \" + channel + \" with \", payload);\n        try {\n          listener.callback(capsule);\n        } catch (e) {\n          logger.error(e);\n        }\n      });\n    }\n    if (this.patterns.length > 0) {\n      if (!payload.message) {\n        logger.warn(\"Cannot perform pattern matching without a message key\");\n        return;\n      }\n      var payloadStr_1 = payload.message;\n      this.patterns.forEach(function (pattern) {\n        var match = payloadStr_1.match(pattern.pattern);\n        if (match) {\n          var _a = __read(match),\n            groups = _a.slice(1);\n          var dispatchingCapsule = __assign(__assign({}, capsule), {\n            patternInfo: groups\n          });\n          try {\n            pattern.callback(dispatchingCapsule);\n          } catch (e) {\n            logger.error(e);\n          }\n        }\n      });\n    }\n  };\n  return HubClass;\n}();\nexport { HubClass };\n/*We export a __default__ instance of HubClass to use it as a\npseudo Singleton for the main messaging bus, however you can still create\nyour own instance of HubClass() for a separate \"private bus\" of events.*/\nexport var Hub = new HubClass('__default__');\n/**\n * @deprecated use named import\n */\nexport default Hub;","map":{"version":3,"sources":["../src/Hub.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nimport { ConsoleLogger as Logger } from './Logger';\nvar logger = new Logger('Hub');\nvar AMPLIFY_SYMBOL = (typeof Symbol !== 'undefined' &&\n    typeof Symbol.for === 'function'\n    ? Symbol.for('amplify_default')\n    : '@@amplify_default');\nfunction isLegacyCallback(callback) {\n    return callback.onHubCapsule !== undefined;\n}\nvar HubClass = /** @class */ (function () {\n    function HubClass(name) {\n        this.listeners = [];\n        this.patterns = [];\n        this.protectedChannels = [\n            'core',\n            'auth',\n            'api',\n            'analytics',\n            'interactions',\n            'pubsub',\n            'storage',\n            'ui',\n            'xr',\n        ];\n        this.name = name;\n    }\n    // Note - Need to pass channel as a reference for removal to work and not anonymous function\n    HubClass.prototype.remove = function (channel, listener) {\n        if (channel instanceof RegExp) {\n            var pattern_1 = this.patterns.find(function (_a) {\n                var pattern = _a.pattern;\n                return pattern.source === channel.source;\n            });\n            if (!pattern_1) {\n                logger.warn(\"No listeners for \" + channel);\n                return;\n            }\n            this.patterns = __spread(this.patterns.filter(function (x) { return x !== pattern_1; }));\n        }\n        else {\n            var holder = this.listeners[channel];\n            if (!holder) {\n                logger.warn(\"No listeners for \" + channel);\n                return;\n            }\n            this.listeners[channel] = __spread(holder.filter(function (_a) {\n                var callback = _a.callback;\n                return callback !== listener;\n            }));\n        }\n    };\n    HubClass.prototype.dispatch = function (channel, payload, source, ampSymbol) {\n        if (source === void 0) { source = ''; }\n        if (this.protectedChannels.indexOf(channel) > -1) {\n            var hasAccess = ampSymbol === AMPLIFY_SYMBOL;\n            if (!hasAccess) {\n                logger.warn(\"WARNING: \" + channel + \" is protected and dispatching on it can have unintended consequences\");\n            }\n        }\n        var capsule = {\n            channel: channel,\n            payload: __assign({}, payload),\n            source: source,\n            patternInfo: [],\n        };\n        try {\n            this._toListeners(capsule);\n        }\n        catch (e) {\n            logger.error(e);\n        }\n    };\n    HubClass.prototype.listen = function (channel, callback, listenerName) {\n        var _this = this;\n        if (listenerName === void 0) { listenerName = 'noname'; }\n        var cb;\n        // Check for legacy onHubCapsule callback for backwards compatability\n        if (isLegacyCallback(callback)) {\n            logger.warn(\"WARNING onHubCapsule is Deprecated. Please pass in a callback.\");\n            cb = callback.onHubCapsule.bind(callback);\n        }\n        else if (typeof callback !== 'function') {\n            throw new Error('No callback supplied to Hub');\n        }\n        else {\n            cb = callback;\n        }\n        if (channel instanceof RegExp) {\n            this.patterns.push({\n                pattern: channel,\n                callback: cb,\n            });\n        }\n        else {\n            var holder = this.listeners[channel];\n            if (!holder) {\n                holder = [];\n                this.listeners[channel] = holder;\n            }\n            holder.push({\n                name: listenerName,\n                callback: cb,\n            });\n        }\n        return function () {\n            _this.remove(channel, cb);\n        };\n    };\n    HubClass.prototype._toListeners = function (capsule) {\n        var channel = capsule.channel, payload = capsule.payload;\n        var holder = this.listeners[channel];\n        if (holder) {\n            holder.forEach(function (listener) {\n                logger.debug(\"Dispatching to \" + channel + \" with \", payload);\n                try {\n                    listener.callback(capsule);\n                }\n                catch (e) {\n                    logger.error(e);\n                }\n            });\n        }\n        if (this.patterns.length > 0) {\n            if (!payload.message) {\n                logger.warn(\"Cannot perform pattern matching without a message key\");\n                return;\n            }\n            var payloadStr_1 = payload.message;\n            this.patterns.forEach(function (pattern) {\n                var match = payloadStr_1.match(pattern.pattern);\n                if (match) {\n                    var _a = __read(match), groups = _a.slice(1);\n                    var dispatchingCapsule = __assign(__assign({}, capsule), { patternInfo: groups });\n                    try {\n                        pattern.callback(dispatchingCapsule);\n                    }\n                    catch (e) {\n                        logger.error(e);\n                    }\n                }\n            });\n        }\n    };\n    return HubClass;\n}());\nexport { HubClass };\n/*We export a __default__ instance of HubClass to use it as a\npseudo Singleton for the main messaging bus, however you can still create\nyour own instance of HubClass() for a separate \"private bus\" of events.*/\nexport var Hub = new HubClass('__default__');\n/**\n * @deprecated use named import\n */\nexport default Hub;\n//# sourceMappingURL=Hub.js.map"]},"metadata":{},"sourceType":"module"}