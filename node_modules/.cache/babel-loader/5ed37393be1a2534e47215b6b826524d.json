{"ast":null,"code":"import Cookies from 'universal-cookie';\nimport { browserOrNode } from '../JS';\nvar isBrowser = browserOrNode().isBrowser;\nvar UniversalStorage = /** @class */function () {\n  function UniversalStorage(context) {\n    if (context === void 0) {\n      context = {};\n    }\n    this.cookies = new Cookies();\n    this.store = isBrowser ? window.localStorage : Object.create(null);\n    this.cookies = context.req ? new Cookies(context.req.headers.cookie) : new Cookies();\n    Object.assign(this.store, this.cookies.getAll());\n  }\n  Object.defineProperty(UniversalStorage.prototype, \"length\", {\n    get: function get() {\n      return Object.entries(this.store).length;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  UniversalStorage.prototype.clear = function () {\n    var _this = this;\n    Array.from(new Array(this.length)).map(function (_, i) {\n      return _this.key(i);\n    }).forEach(function (key) {\n      return _this.removeItem(key);\n    });\n  };\n  UniversalStorage.prototype.getItem = function (key) {\n    return this.getLocalItem(key);\n  };\n  UniversalStorage.prototype.getLocalItem = function (key) {\n    return Object.prototype.hasOwnProperty.call(this.store, key) ? this.store[key] : null;\n  };\n  UniversalStorage.prototype.getUniversalItem = function (key) {\n    return this.cookies.get(key);\n  };\n  UniversalStorage.prototype.key = function (index) {\n    return Object.keys(this.store)[index];\n  };\n  UniversalStorage.prototype.removeItem = function (key) {\n    this.removeLocalItem(key);\n    this.removeUniversalItem(key);\n  };\n  UniversalStorage.prototype.removeLocalItem = function (key) {\n    delete this.store[key];\n  };\n  UniversalStorage.prototype.removeUniversalItem = function (key) {\n    this.cookies.remove(key, {\n      path: '/'\n    });\n  };\n  UniversalStorage.prototype.setItem = function (key, value) {\n    this.setLocalItem(key, value);\n    // keys take the shape:\n    //  1. `${ProviderPrefix}.${userPoolClientId}.${username}.${tokenType}\n    //  2. `${ProviderPrefix}.${userPoolClientId}.LastAuthUser\n    var tokenType = key.split('.').pop();\n    switch (tokenType) {\n      // LastAuthUser is needed for computing other key names\n      case 'LastAuthUser':\n      // accessToken is required for CognitoUserSession\n      case 'accessToken':\n      // refreshToken originates on the client, but SSR pages won't fail when this expires\n      // Note: the new `accessToken` will also be refreshed on the client (since Amplify doesn't set server-side cookies)\n      case 'refreshToken':\n      // Required for CognitoUserSession\n      case 'idToken':\n        isBrowser ? this.setUniversalItem(key, value) : this.setLocalItem(key, value);\n      // userData is used when `Auth.currentAuthenticatedUser({ bypassCache: false })`.\n      // Can be persisted to speed up calls to `Auth.currentAuthenticatedUser()`\n      // case 'userData':\n      // Ignoring clockDrift on the server for now, but needs testing\n      // case 'clockDrift':\n    }\n  };\n\n  UniversalStorage.prototype.setLocalItem = function (key, value) {\n    this.store[key] = value;\n  };\n  UniversalStorage.prototype.setUniversalItem = function (key, value) {\n    this.cookies.set(key, value, {\n      path: '/',\n      // `httpOnly` cannot be set via JavaScript: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#JavaScript_access_using_Document.cookie\n      sameSite: true,\n      // Allow unsecure requests to http://localhost:3000/ when in development.\n      secure: window.location.hostname === 'localhost' ? false : true\n    });\n  };\n  return UniversalStorage;\n}();\nexport { UniversalStorage };","map":{"version":3,"sources":["../../src/UniversalStorage/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import Cookies from 'universal-cookie';\nimport { browserOrNode } from '../JS';\nvar isBrowser = browserOrNode().isBrowser;\nvar UniversalStorage = /** @class */ (function () {\n    function UniversalStorage(context) {\n        if (context === void 0) { context = {}; }\n        this.cookies = new Cookies();\n        this.store = isBrowser ? window.localStorage : Object.create(null);\n        this.cookies = context.req\n            ? new Cookies(context.req.headers.cookie)\n            : new Cookies();\n        Object.assign(this.store, this.cookies.getAll());\n    }\n    Object.defineProperty(UniversalStorage.prototype, \"length\", {\n        get: function () {\n            return Object.entries(this.store).length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    UniversalStorage.prototype.clear = function () {\n        var _this = this;\n        Array.from(new Array(this.length))\n            .map(function (_, i) { return _this.key(i); })\n            .forEach(function (key) { return _this.removeItem(key); });\n    };\n    UniversalStorage.prototype.getItem = function (key) {\n        return this.getLocalItem(key);\n    };\n    UniversalStorage.prototype.getLocalItem = function (key) {\n        return Object.prototype.hasOwnProperty.call(this.store, key)\n            ? this.store[key]\n            : null;\n    };\n    UniversalStorage.prototype.getUniversalItem = function (key) {\n        return this.cookies.get(key);\n    };\n    UniversalStorage.prototype.key = function (index) {\n        return Object.keys(this.store)[index];\n    };\n    UniversalStorage.prototype.removeItem = function (key) {\n        this.removeLocalItem(key);\n        this.removeUniversalItem(key);\n    };\n    UniversalStorage.prototype.removeLocalItem = function (key) {\n        delete this.store[key];\n    };\n    UniversalStorage.prototype.removeUniversalItem = function (key) {\n        this.cookies.remove(key, {\n            path: '/',\n        });\n    };\n    UniversalStorage.prototype.setItem = function (key, value) {\n        this.setLocalItem(key, value);\n        // keys take the shape:\n        //  1. `${ProviderPrefix}.${userPoolClientId}.${username}.${tokenType}\n        //  2. `${ProviderPrefix}.${userPoolClientId}.LastAuthUser\n        var tokenType = key.split('.').pop();\n        switch (tokenType) {\n            // LastAuthUser is needed for computing other key names\n            case 'LastAuthUser':\n            // accessToken is required for CognitoUserSession\n            case 'accessToken':\n            // refreshToken originates on the client, but SSR pages won't fail when this expires\n            // Note: the new `accessToken` will also be refreshed on the client (since Amplify doesn't set server-side cookies)\n            case 'refreshToken':\n            // Required for CognitoUserSession\n            case 'idToken':\n                isBrowser\n                    ? this.setUniversalItem(key, value)\n                    : this.setLocalItem(key, value);\n            // userData is used when `Auth.currentAuthenticatedUser({ bypassCache: false })`.\n            // Can be persisted to speed up calls to `Auth.currentAuthenticatedUser()`\n            // case 'userData':\n            // Ignoring clockDrift on the server for now, but needs testing\n            // case 'clockDrift':\n        }\n    };\n    UniversalStorage.prototype.setLocalItem = function (key, value) {\n        this.store[key] = value;\n    };\n    UniversalStorage.prototype.setUniversalItem = function (key, value) {\n        this.cookies.set(key, value, {\n            path: '/',\n            // `httpOnly` cannot be set via JavaScript: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#JavaScript_access_using_Document.cookie\n            sameSite: true,\n            // Allow unsecure requests to http://localhost:3000/ when in development.\n            secure: window.location.hostname === 'localhost' ? false : true,\n        });\n    };\n    return UniversalStorage;\n}());\nexport { UniversalStorage };\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}